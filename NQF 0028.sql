USE analive;
GO
DECLARE @START_DATE DATETIME
DECLARE @END_DATE DATETIME
SET @START_DATE = '01/01/2016'
SET @END_DATE = '12/31/2016'

SELECT
CAEMP.ID, CAEMP.SORT_NAME AS [PROVIDER NAME], COUNT (DISTINCT sv.[CLIENT_ID]) AS [COUNT OF CLIENTS]

FROM CDCLSVC sv
		LEFT JOIN CDCLIENT ON sv.CLIENT_ID = CDCLIENT.ID
				AND sv.[BEG_DATE] between @START_DATE AND @END_DATE AND
				ISNULL(VOID_FLAG,'')<>'Y' AND
				[CNTTYP_ID] = 'F' AND
				[APPTYP_ID] IN (1, 2) AND
				CDCLIENT.[DOB] BETWEEN DATEADD (YEAR, -150, sv.BEG_DATE) AND DATEADD (YEAR, -13, sv.BEG_DATE)
		LEFT JOIN CAEMP ON sv.EMP_ID = CAEMP.ID 
		LEFT JOIN CDSVRCRD ON sv.EMP_ID = CDSVRCRD.EMP_ID
		LEFT JOIN CDCLDIAG ON CDCLDIAG.CLIENT_ID = CDCLIENT.ID
		LEFT JOIN CDCLINS ON CDCLINS.CLIENT_ID = CDCLIENT.ID

WHERE sv.[BEG_DATE] between @START_DATE AND @END_DATE AND
				ISNULL(VOID_FLAG,'')<>'Y' AND
				[CNTTYP_ID] = 'F' AND
				[APPTYP_ID] IN (1, 2) AND
				CDCLIENT.[DOB] BETWEEN DATEADD (YEAR, -150, sv.BEG_DATE) AND DATEADD (YEAR, -18, sv.BEG_DATE) AND
				[SVC_ID] IN ('3505', '3001', '3500', '1101', '1102', '1103', '1104', '1105', '1111', '1112', '1113', '1114',
				'1115', '1335', '1336'
				) AND CDCLDIAG.END_DATE IS NULL AND
				PAYSRC_ID = '1' AND 
		CAEMP.ID IN ('379', '1556', '2069', '2695', '2753', '4452', '5743', '5910', '5946', '5998', '5999', '6021', '6026', 
			'10154', '10226', '10423', '10581', '13137', '13431', '13537', '14033', '14143', '14218', '14286', '14770', '14824', 
			'15048', '15059', '15748', '15771', '15772', '15864', '15891', '16002', '16021', '16022', '16097', '16150', '16239',
			'16245', '16277', '16294', '16388', '16499', '16574', '16604', '16627', '16691', '16743', '16754', '16759', '16777',
			'16778', '16884', '16906', '16976', '16989', '17045', '17082', '17103', '17105', '17111', '17116', '17124', '17146', 
			'17155', '17223', '17234', '17243', '17307', '17321', '100027', '100028', '100052', '100099', '100156', '100171',
			'100184', '100207', '100215', '100235', '100278', '100284', '100346', '100349', '100364', '100455', '100484',
			'100488', '100492', '100511'

)

GROUP BY CAEMP.SORT_NAME, CAEMP.ID